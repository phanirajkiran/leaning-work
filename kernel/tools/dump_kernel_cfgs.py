'''
A script to dump cfgs 
'''
#!/usr/bin/python
import subprocess
from optparse import OptionParser
import os

#child = subprocess.Popen('ping -c4 blog.linuxeye.com',shell=True)



blacklist = ['features/telemetry/intel-telemetry.scc', 'features/minnow-io/minnow-io.scc', 'features/sound/snd_hda_intel.scc', 'features/ftrace/ftrace-function-tracer-disable.scc', 'features/net/stmicro/stmmac.scc', 'features/mac80211/mac80211.scc', 'features/r8169/r8169.scc', 'features/usb/designware-usb3.scc', 'features/usb/touchscreen-composite.scc', 'features/usb/uhci-hcd.scc', 'features/usb/ohci-hcd.scc', 'features/usb/usb-base.scc', 'features/usb/designware-usb2.scc', 'features/usb/ehci-hcd.scc', 'features/usb/usb-typec.scc', 'features/usb/usb-gadgets.scc', 'features/usb/xhci-hcd.scc', 'features/usb/serial-all.scc', 'features/6lowpan/6lowpan.scc','features/cma/cma.scc', 'features/soc/broxton/broxton.scc', 'features/soc/skylake/skylake.scc', 'features/soc/x1000/x1000.scc', 'features/soc/tunnelcreek/tunnelcreek.scc', 'features/soc/baytrail/baytrail.scc', 'features/gma500/gma500.scc', 'features/i915/i915.scc', 'features/i40e/i40e.scc', 'features/grsec/grsec.scc', 'features/ixgbe/ixgbe.scc', 'features/serial/8250.scc', 'features/powerclamp/powerclamp.scc', 'features/media/media-tuners.scc', 'features/media/media-i2c.scc', 'features/media/media-dvb-frontends.scc', 'features/media/media-all.scc', 'features/media/media-radio.scc', 'features/media/media-platform.scc', 'features/media/media-rc.scc', 'features/media/media-pci-capture.scc', 'features/media/media-usb-tv.scc', 'features/media/media.scc', 'features/media/media-usb-webcams.scc', 'features/rapl/rapl.scc', 'features/pwm/pwm.scc', 'features/pwm/intel_pwm.scc', 'features/nxp_qoriq/sdk-2-0/sdk-2-0.scc', 'features/nxp_qoriq/sdk-2-0.scc', 'features/nxp_qoriq/sdk-2-0-std.scc', 'features/nxp_qoriq/nxp.scc', 'features/nxp_qoriq/sdk-2-0-rt.scc', 'features/iio/iio.scc', 'features/rt/rt.scc', 'features/igb/igb.scc', 'features/ciphers/ciphers.scc', 'features/rfkill/rfkill.scc', 'features/netfilter/netfilter.scc', 'features/i2c/i2cdbg.scc', 'features/i2c/i2cdev.scc', 'features/i2c/i2c.scc', 'features/intel-mid-8250/intel-mid-8250.scc', 'features/intel-e1xxxx/intel-e1xxxx.scc', 'features/intel-e1xxxx/intel-e100.scc', 'features/iwlwifi/iwlwifi.scc', 'features/xip/xip.scc', 'features/drm-emgd/drm-emgd-1.18.scc', 'features/aufs/aufs-disable.scc', 'features/misc/bosch-pressure-sensor-i2c.scc', 'features/dca/dca.scc', 'features/thermal/coretemp.scc', 'features/mwifiex/mwifiex.scc', 'features/revoke/revoke.scc',  'features/drm-gma500/drm-gma500.scc', 'features/firmware/firmware.scc', 'features/input/touchscreen-zforce.scc', 'features/input/keyboard-gpio.scc', 'features/input/touchscreen.scc', 'features/input/input.scc', 'features/eg20t/eg20t.scc', 'features/edac/edac.scc', 'features/edac/edac-mpc85xx.scc', 'features/edac/edac-x86.scc', 'features/intel-pinctrl/intel-pinctrl.scc', 'features/ipmi/ipmi.scc', 'features/spi/spidev.scc', 'features/spi/spi.scc', 'features/nvidia/nvidia.scc', 'features/bluetooth/bluetooth.scc', 'features/bluetooth/bluetooth-usb.scc', 'features/pci-iov/pci-iov.scc', 'features/pvr/pvr.scc', 'features/power/intel_pmic.scc', 'features/power/intel.scc', 'features/power/bq25890.scc', 'features/drm-psb/drm-psb.scc', 'features/intel-dpdk/intel-dpdk.scc', 'features/usb-net/usb-net.scc', 'features/mfd/mfd-intel-lpss.scc', 'features/ericsson-3g/f5521gw.scc', 'features/radeon/radeon.scc', 'features/pci/pci.scc', 'features/leds/leds.scc', 'features/iwlegacy/iwlegacy.scc', 'features/ieee802154/ieee802154.scc', 'features/uio/uio.scc', 'features/mmc/mmc-sdhci.scc', 'features/mmc/mmc-block.scc', 'features/mmc/mmc-base.scc', 'features/ocf/ocf.scc', 'features/qat/qat.scc', 'features/rpmb/rpmb-base.scc', 'features/rpmb/rpmb-uapi.scc', 'features/rpmb/rpmb-sim.scc', 'features/hdmi-audio/hdmi-audio.scc', 'features/mei/mei-me.scc', 'features/mei/amt.scc', 'features/mei/mei-spd.scc', 'features/mei/mei.scc', 'features/mei/mei-txe.scc', 'features/intel-iommu/intel-iommu.scc', 'features/tpm/tpm.scc', 'features/wr-rt/wr-rt.scc', 'features/scsi/cdrom.scc', 'features/scsi/scsi.scc', 'features/scsi/disk.scc']

blacklist.append('features/net/net-all.scc')

blacklist=['features/telemetry/intel-telemetry.cfg', 'features/minnow-io/minnow-io.cfg', 'features/sound/snd_hda_intel.cfg', 'features/ftrace/ftrace-function-tracer-disable.cfg', 'features/net/stmicro/stmmac.cfg', 'features/mac80211/mac80211.cfg', 'features/r8169/r8169.cfg', 'features/usb/ehci-hcd.cfg', 'features/usb/usb-base.cfg', 'features/usb/usb-gadgets.cfg', 'features/usb/designware-usb2.cfg', 'features/usb/ohci-hcd.cfg', 'features/usb/designware-usb3.cfg', 'features/usb/xhci-hcd.cfg', 'features/usb/touchscreen-composite.cfg', 'features/usb/uhci-hcd.cfg', 'features/usb/usb-typec.cfg', 'features/usb/serial-all.cfg', 'features/6lowpan/6lowpan.cfg', 'features/cma/cma.cfg', 'features/soc/broxton/broxton.cfg', 'features/soc/skylake/skylake.cfg', 'features/soc/x1000/x1000.cfg', 'features/soc/baytrail/baytrail.cfg', 'features/i915/i915.cfg', 'features/i40e/i40e.cfg', 'features/grsec/pax.cfg', 'features/grsec/grsec.cfg', 'features/ixgbe/ixgbe.cfg', 'features/powerclamp/powerclamp.cfg', 'features/media/media-dvb-frontends.cfg', 'features/media/media-usb-webcams.cfg', 'features/media/media-usb-tv.cfg', 'features/media/media.cfg', 'features/media/media-platform.cfg', 'features/media/media-pci-capture.cfg', 'features/media/media-rc.cfg', 'features/media/media-tuners.cfg', 'features/media/media-i2c.cfg', 'features/media/media-radio.cfg', 'features/rapl/rapl.cfg', 'features/kdump/e500-kdump.cfg', 'features/pwm/pwm.cfg', 'features/pwm/intel_pwm.cfg', 'features/iio/iio.cfg', 'features/igb/igb.cfg', 'features/ciphers/ciphers.cfg', 'features/rfkill/rfkill.cfg', 'features/rfkill/non-hardware.cfg', 'features/i2c/i2c.cfg', 'features/i2c/i2cdev.cfg', 'features/i2c/i2cdbg.cfg', 'features/intel-mid-8250/intel-mid-8250.cfg', 'features/intel-e1xxxx/intel-e1xxxx.cfg', 'features/intel-e1xxxx/intel-e100.cfg', 'features/iwlwifi/iwlwifi.cfg', 'features/drm-emgd/drm-emgd.cfg', 'features/aufs/aufs-disable.cfg', 'features/misc/bosch-pressure-sensor-i2c.cfg', 'features/dca/dca.cfg', 'features/thermal/coretemp.cfg', 'features/mwifiex/mwifiex.cfg', 'features/drm-gma500/drm-gma500.cfg', 'features/firmware/firmware.cfg', 'features/input/input.cfg', 'features/input/touchscreen.cfg', 'features/input/keyboard-gpio.cfg', 'features/input/zforce.cfg', 'features/eg20t/eg20t.cfg', 'features/edac/edac-x86.cfg', 'features/edac/edac-mpc85xx.cfg', 'features/edac/edac.cfg', 'features/intel-pinctrl/intel-pinctrl.cfg', 'features/ipmi/ipmi.cfg', 'features/spi/spidev.cfg', 'features/spi/spi.cfg', 'features/nvidia/nvidia.cfg', 'features/bluetooth/bluetooth-usb.cfg', 'features/bluetooth/bluetooth.cfg', 'features/pci-iov/pci-iov.cfg', 'features/hostapd/hostapd.cfg', 'features/power/intel.cfg', 'features/power/intel_pmic.cfg', 'features/power/bq25890.cfg', 'features/drm-psb/hardware.cfg', 'features/drm-psb/drm-psb.cfg', 'features/intel-dpdk/intel-dpdk.cfg', 'features/usb-net/usb-net.cfg', 'features/mfd/mfd-intel-lpss.cfg', 'features/ericsson-3g/f5521gw.cfg', 'features/radeon/radeon.cfg', 'features/pci/pci.cfg', 'features/leds/leds.cfg', 'features/iwlegacy/iwlegacy.cfg', 'features/ieee802154/ieee802154.cfg', 'features/uio/uio.cfg', 'features/mmc/mmc-sdhci.cfg', 'features/mmc/mmc-block.cfg', 'features/mmc/mmc-base.cfg', 'features/ocf/ocf.cfg', 'features/qat/qat.cfg', 'features/rpmb/rpmb-sim.cfg', 'features/rpmb/rpmb-base.cfg', 'features/rpmb/rpmb-uapi.cfg', 'features/hdmi-audio/hdmi-audio.cfg', 'features/mei/mei-spd.cfg', 'features/mei/mei-me.cfg', 'features/mei/amt.cfg', 'features/mei/mei-txe.cfg', 'features/mei/mei.cfg', 'features/intel-iommu/intel-iommu.cfg', 'features/tpm/tpm.cfg', 'features/wr-rt/wr-rt.cfg', 'features/scsi/cdrom.cfg', 'features/scsi/scsi.cfg', 'features/scsi/disk.cfg']

def get_sccs():
    configs=subprocess.check_output("find . -name *.cfg",shell=True)
    return map(lambda x: x.replace('./','features/'),configs.split()) 

print get_sccs()
def get_kernel_sccs(sccs,blacklist):
    return filter(lambda x:x not in blacklist,sccs)

print " ".join(get_kernel_sccs(get_sccs(),blacklist))
configs=""
for i in get_kernel_sccs(get_sccs(),blacklist):
    try:
        configs=subprocess.check_output("cat %s |grep ^CONFIG" %(i.replace("features/","")),shell=True)
    except:
        pass
    finally:
        print configs
